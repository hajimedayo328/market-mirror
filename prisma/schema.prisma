generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Idea {
  id               Int        @id @default(autoincrement())
  title            String     @db.VarChar(200)
  description      String
  targetAudience   String     @db.VarChar(500)
  category         String?    @db.VarChar(100)
  expectedPrice    Decimal?   @db.Decimal(10, 2)
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  parentId         Int?
  status           String     @default("draft") @db.VarChar(50)
  version          Int        @default(1)
  parent           Idea?      @relation("IdeaVersions", fields: [parentId], references: [id])
  improvements     Idea[]     @relation("IdeaVersions")
  adoptedProposals Proposal[] @relation("AdoptedProposal")
  proposals        Proposal[] @relation("IdeaProposals")
  reviews          Review[]

  @@map("ideas")
}

model Persona {
  id             Int      @id @default(autoincrement())
  name           String   @db.VarChar(100)
  age            Int
  gender         String   @db.VarChar(20)
  occupation     String   @db.VarChar(100)
  annualIncome   Int
  personality    String
  hobbies        String
  challenges     String
  buyingBehavior String
  createdAt      DateTime @default(now())
  category       String   @db.VarChar(100)
  reviews        Review[]

  @@map("personas")
}

model Review {
  id                    Int      @id @default(autoincrement())
  ideaId                Int
  personaId             Int
  score                 Int
  comment               String
  willBuy               Boolean
  improvementSuggestion String
  pricePerception       String?  @db.VarChar(50)
  trustLevel            Int?
  createdAt             DateTime @default(now())
  idea                  Idea     @relation(fields: [ideaId], references: [id], onDelete: Cascade)
  persona               Persona  @relation(fields: [personaId], references: [id], onDelete: Cascade)

  @@unique([ideaId, personaId])
  @@index([ideaId])
  @@index([personaId])
  @@map("reviews")
}

model Proposal {
  id              Int       @id @default(autoincrement())
  sourceIdeaId    Int
  title           String    @db.VarChar(200)
  description     String
  targetAudience  String    @db.VarChar(500)
  status          String    @default("pending") @db.VarChar(50)
  adoptedAsIdeaId Int?
  aiReasoning     String?
  estimatedScore  Decimal?  @db.Decimal(3, 1)
  selectionReason String?
  createdAt       DateTime  @default(now())
  adoptedAt       DateTime?
  adoptedIdea     Idea?     @relation("AdoptedProposal", fields: [adoptedAsIdeaId], references: [id])
  sourceIdea      Idea      @relation("IdeaProposals", fields: [sourceIdeaId], references: [id], onDelete: Cascade)

  @@index([sourceIdeaId])
  @@index([status])
  @@map("proposals")
}
